<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Job - o2r web API</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../o2r.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Job";
    var mkdocs_page_input_path = "job.md";
    var mkdocs_page_url = "/job/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> o2r web API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Index</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../upload/">Upload</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Job</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#job">Job</a></li>
                
                    <li><a class="toctree-l4" href="#steps">Steps</a></li>
                
                    <li><a class="toctree-l4" href="#new-job">New job</a></li>
                
                    <li><a class="toctree-l4" href="#list-jobs">List jobs</a></li>
                
                    <li><a class="toctree-l4" href="#view-single-job">View single job</a></li>
                
                    <li><a class="toctree-l4" href="#job-status-updates">Job status updates</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../compendium/">Compendium</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../files/">Files</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../files-mime/">Mime-types</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../user/">User</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../search/">Search</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../shipment/">Shipment</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">o2r web API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Job</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="job">Job</h1>
<p><strong>Stability:</strong> 0 - subject to changes</p>
<p>Execution jobs are used to execute a research compendium. When a new execution job is started, the contents of the research compendium are cloned to create a trackable execution. The status information, logs and final working directory data are saved in their final state, so that they can be reviewed later on.</p>
<p>All execution jobs are tied to a single research compendium and reflect the execution history of that research compendium.</p>
<p>A trivial execution job would be a completely unmodified research compendium, to test the reproducibility of a research compendium.</p>
<p>(A <em>potential</em> future feature would be that the input data (input files, datasets, parameters) can be altered to run a modified execution job. This functionality is not yet implemented.)</p>
<h2 id="steps">Steps</h2>
<p>One job consists of a series of steps. All of these steps can be in one of three status: <code>running</code>, <code>failure</code>, or <code>success</code>. The are executed in order.</p>
<ul>
<li><strong>validate_bag</strong>
  Validate the BagIt bag based on npm's <a href="https://www.npmjs.com/package/bagit">bagit</a>.</li>
<li><strong>validate_compendium</strong>
  Parses and validate the bagtainer configuration and metadta.</li>
<li><strong>image_prepare</strong>
  Create an archive of the payload of the BagIt bag, which allows to build and run the image also on remote Docker hosts.</li>
<li><strong>image_build</strong>
  Send the bag's payload as a tarballed archive to Docker to build an image, which is tagged <code>bagtainer:&lt;jobid&gt;</code>.</li>
<li><strong>image_execute</strong>
  Run the container and return based on status code of program that ran inside the container.</li>
<li><strong>cleanup</strong>
  Remove image or job files (depending on server-side settings).</li>
</ul>
<h2 id="new-job">New job</h2>
<p>Create and run a new execution job. Requires a <code>compendium_id</code>.</p>
<p><code>curl -F compendium_id=$ID https://…/api/v1/job</code></p>
<p><code>POST /api/v1/job</code></p>
<pre><code class="json">200 OK

{&quot;job_id&quot;:&quot;ngK4m&quot;}
</code></pre>

<h3 id="body-parameters">Body parameters</h3>
<ul>
<li><code>compendium_id</code> - The <code>id</code> of the compendium to base this job on.</li>
<li><code>steps</code> - <strong>TODO</strong> select steps that will be executed (skip some steps in successive executions?)</li>
<li><code>inputs</code> - <strong><em>proposal</em></strong> - Array with one or more <code>FileDescriptor</code>.</li>
</ul>
<h3 id="error-responses">Error responses</h3>
<pre><code class="json">404 Not Found

{&quot;error&quot;:&quot;no compendium with this ID found&quot;}
</code></pre>

<pre><code class="json">500 Internal Server Error

{&quot;error&quot;:&quot;could not create job&quot;}
</code></pre>

<h2 id="list-jobs">List jobs</h2>
<p><strong>Stability:</strong> 0 - subject to changes</p>
<p>Lists jobs. Will return up to 100 results by default.</p>
<p>For pagination purposes, URLs for previous and next results are provided if applicable. Results will be sorted by descending date of last change. Results can be filtered by one or more compendiums, i.e. parameter <code>compendium_id</code>, as well as by <code>state</code>.
The content of the response can be limited to certain properties of each result by providing a list of fields, i.e. the parameter <code>fields</code>.</p>
<p><code>curl -F compendium_id=$ID https://…/api/v1/job?limit=100&amp;start=2&amp;compendium_id=$ID&amp;state=success</code></p>
<p><code>GET /api/v1/job?limit=100&amp;start=2&amp;compendium_id=a4Dnm&amp;state=success</code></p>
<pre><code class="json">200 OK

{
  &quot;results&quot;:[
    &quot;nkm4L&quot;,
    &quot;asdi5&quot;,
    &quot;nb2sg&quot;,
    …
  ],
  &quot;next&quot;:&quot;/api/v1/job?limit=100&amp;start=3&quot;,
  &quot;previous&quot;:&quot;/api/v1/job?limit=100&amp;start=1&quot;
}
</code></pre>

<p><code>GET /api/v1/job?limit=100&amp;start=2&amp;compendium_id=a4Dnm&amp;state=success&amp;fields=state</code></p>
<pre><code class="json">200 OK

{
  &quot;results&quot;:[
    {
      &quot;id&quot;:&quot;nkm4L&quot;,
      &quot;state&quot;:&quot;failure&quot;
    },
    {
      &quot;id&quot;:&quot;asdi5&quot;,
      &quot;state&quot;:&quot;success&quot;
    },
    {
      &quot;id&quot;:&quot;nb2sg&quot;,
      &quot;state&quot;:&quot;running&quot;
    },
    …
  ],
  &quot;next&quot;:&quot;/api/v1/job?limit=100&amp;start=3&amp;fields=state&quot;,
  &quot;previous&quot;:&quot;/api/v1/job?limit=100&amp;start=1&amp;fields=state&quot;
}
</code></pre>

<h3 id="get-parameters">GET parameters</h3>
<ul>
<li><code>compendium_id</code> - Comma-separated list of related compendium ids to filter by.</li>
<li><code>start</code> - List from specific search result onwards. 1-indexed. Defaults to 1.</li>
<li><code>limit</code> - Specify maximum amount of results per page. Defaults to 100.</li>
<li><code>state</code> - Specify state to filter by. Can contain following states: <code>success</code>, <code>failure</code>, <code>running</code>.</li>
<li><code>fields</code> - Specify if/which additional attributes results should contain. Allowed values are <code>state</code>. Defaults to none (<code>&#32;</code>).</li>
</ul>
<h3 id="state">State</h3>
<p>Shows the overall state of a job.</p>
<p>The status will be one of following:</p>
<ul>
<li><code>success</code> - if state of all steps is <code>success</code>.</li>
<li><code>failure</code> - if state of at least one step is <code>failure</code>.</li>
<li><code>running</code> - if state of at least one step is <code>running</code> and no state is <code>failure</code>.</li>
</ul>
<p>More information about <code>steps</code> can be found in subsection <code>Steps</code> of section <code>View single job</code>.</p>
<h2 id="view-single-job">View single job</h2>
<p><strong>Stability:</strong> 0 - subject to changes</p>
<p>View details for a single job. Filelisting format is described in <a href="../files/">Files</a></p>
<p><code>curl https://…/api/v1/job/$ID</code></p>
<p><code>GET /api/v1/job/:id</code></p>
<pre><code class="json">200 OK

{
  &quot;id&quot;:&quot;nkm4L&quot;,
  &quot;compendium_id&quot;:&quot;a4Dnm&quot;,
  &quot;creation_date&quot;: Date,
  &quot;state&quot;: &quot;fail&quot;,
  &quot;steps&quot;:{
    &quot;unpack&quot;:{
      &quot;status&quot;:&quot;failure&quot;,
      &quot;start&quot;: Date,
      &quot;end&quot;: Date,
      &quot;text&quot;:&quot;not a valid archive&quot;
    },
    …
  },
  &quot;files&quot;:{
    {FileListing}
  }
}
</code></pre>

<h3 id="url-parameters">URL parameters</h3>
<ul>
<li><code>:id</code> - id of the job to be viewed</li>
</ul>
<h3 id="steps_1">Steps</h3>
<p>The answer will contain information to the following <code>steps</code>:</p>
<ul>
<li><code>validate_bag</code></li>
<li><code>validate_compendium</code></li>
<li><code>image_prepare</code></li>
<li><code>image_build</code></li>
<li><code>image_execute</code></li>
<li><code>cleanup</code></li>
</ul>
<p>Their status will be one of:</p>
<ul>
<li><code>queued</code></li>
<li><code>running</code></li>
<li><code>success</code></li>
<li><code>failure</code></li>
<li><code>warning</code></li>
<li><code>skip</code></li>
</ul>
<p>Additional explanations to their state will be transmitted in the <code>text</code> property. The <code>start</code> and <code>end</code> timestamps indicate the start and end time of the step. They are formatted as ISO8601.</p>
<h3 id="error-responses_1">Error responses</h3>
<pre><code class="json">404 Not Found

{&quot;error&quot;:&quot;no compendium with this ID found&quot;}
</code></pre>

<h2 id="job-status-updates">Job status updates</h2>
<p>You can subscribe to real time status updates on jobs using <a href="https://en.wikipedia.org/wiki/WebSocket">WebSockets</a>. The implementation is based on <a href="http://socket.io">socket.io</a> and using their client is recommended.</p>
<p>The job log is available at <code>https://o2r.uni-muenster.de</code> under the namespace <code>api/v1/logs/job</code>.</p>
<pre><code class="JavaScript"># create a socket.io client:
var socket = io('https://o2r.uni-muenster.de/api/v1/logs/job');
</code></pre>

<p><strong>TODO</strong>: add documentation on messages on the socket.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../compendium/" class="btn btn-neutral float-right" title="Compendium">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../upload/" class="btn btn-neutral" title="Upload"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../upload/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../compendium/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
