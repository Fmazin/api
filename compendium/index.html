<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>View and download - o2r web API</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../o2r.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "View and download";
    var mkdocs_page_input_path = "compendium.md";
    var mkdocs_page_url = "/compendium/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> o2r web API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Compendium</span></li>

        
            
    <ul class="subnav">
    <li><span>Create new compendium</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../upload/">API upload</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../public-share/">Public share submission</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">View and download</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#compendium">Compendium</a></li>
                
                    <li><a class="toctree-l4" href="#list-compendia">List compendia</a></li>
                
                    <li><a class="toctree-l4" href="#view-single-compendium">View single compendium</a></li>
                
                    <li><a class="toctree-l4" href="#download-compendium">Download compendium</a></li>
                
                    <li><a class="toctree-l4" href="#list-related-execution-jobs">List related execution jobs</a></li>
                
                    <li><a class="toctree-l4" href="#metadata">Metadata</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../files/">Files in a compendium</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../job/">Job</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../search/">Search</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../shipment/">Shipment</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../user/">User</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">o2r web API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Compendium &raquo;</li>
        
      
    
    <li>View and download</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="compendium">Compendium</h1>
<h2 id="list-compendia">List compendia</h2>
<p>Will return up to 100 results by default. For pagination purposes, URLs for previous and next results are provided if applicable.</p>
<p><code>curl https://…/api/v1/compendium?limit=100&amp;start=2</code></p>
<p><code>GET /api/v1/compendium?limit=100&amp;start=2</code></p>
<pre><code class="json">200 OK

{
  &quot;results&quot;:[
    &quot;nkm4b&quot;,
    &quot;asdis&quot;,
    &quot;nb2sm&quot;,
    …
  ],
  &quot;next&quot;:&quot;/api/v1/compendium?limit=100&amp;start=3&quot;,
  &quot;previous&quot;:&quot;/api/v1/compendium?limit=100&amp;start=1&quot;
}
</code></pre>

<p>You can also get only the compendia uploaded by a specific user. A user filter can be combined with pagination.</p>
<p><code>curl http://…/api/v1/compendium?user=0000-0001-6021-1617</code></p>
<p><code>GET /api/v1/compendium?user=0000-0001-6021-1617</code></p>
<pre><code class="json">200 OK

{
  &quot;results&quot;:[
    &quot;nkm4b&quot;,
    &quot;nb2sm&quot;
  ]
}
</code></pre>

<h3 id="url-parameters-for-compendium-lists">URL parameters for compendium lists</h3>
<ul>
<li><code>job_id</code> - Comma-separated list of related job ids to filter by.</li>
<li><code>user</code> - Public user identifier to filter by.</li>
<li><code>start</code> - List from specific search result onwards. 1-indexed. Defaults to 1.</li>
<li><code>limit</code> - Specify maximum amount of results per page. Defaults to 100.</li>
</ul>
<h3 id="error-responses-for-compendium-lists">Error responses for compendium lists</h3>
<pre><code class="json">404 Not Found

{&quot;error&quot;:&quot;no compendium found&quot;}
</code></pre>

<h2 id="view-single-compendium">View single compendium</h2>
<p>This includes the complete metadata set, related job ids and a tree representation of the included <a href="../files/">files</a>. The <code>created</code> timestamp refers to the upload of the compendium. It is formated as ISO8601.</p>
<p><code>curl https://…/api/v1/$ID</code></p>
<p><code>GET /api/v1/compendium/:id</code></p>
<pre><code class="json">200 OK

{
  &quot;id&quot;:&quot;comid&quot;,
  &quot;metadata&quot;: … ,
  &quot;created&quot;: &quot;2016-08-01T13:57:40.760Z&quot;,
  &quot;files&quot;: …
 }
</code></pre>

<h3 id="url-parameters-for-single-compendium-view">URL parameters for single compendium view</h3>
<ul>
<li><code>:id</code> - the compendiums id</li>
</ul>
<h3 id="error-responses-for-single-compendium-view">Error responses for single compendium view</h3>
<pre><code class="json">404 Not Found

{&quot;error&quot;:&quot;no compendium with this id&quot;}
</code></pre>

<h2 id="download-compendium">Download compendium</h2>
<p>Download the complete compendium as an archive. Supported formats are as follows:</p>
<ul>
<li><code>zip</code></li>
<li><code>tar</code></li>
<li><code>tar.gz</code> (gzipped tarball)</li>
</ul>
<h3 id="requests">Requests</h3>
<p><code>curl https://…/api/v1/compendium/$ID.zip</code></p>
<p><code>wget https://…/api/v1/compendium/$ID.zip</code></p>
<pre><code class="bash">GET /api/v1/compendium/:id.zip
GET /api/v1/compendium/:id.tar
GET /api/v1/compendium/:id.tar.gz
GET /api/v1/compendium/:id.tar?gzip
GET /api/v1/compendium/:id.zip?image=false
</code></pre>

<h3 id="response">Response</h3>
<p>The response is a file attachment. The suggested file name is available in the HTTP header <code>content-disposition</code> using the respective file extension (i.e. <code>.zip</code>, <code>.tar</code>, and <code>.tar.gz</code>).</p>
<p>The <code>content-type</code> header also reflects the respective format, which can take the following values:</p>
<ul>
<li><code>application/zip</code> for ZIP archive</li>
<li><code>application/x-tar</code> for TAR archive</li>
<li><code>application/octet-stream</code> for gzipped TAR</li>
</ul>
<pre><code class="txt">200 OK
Content-Type: application/zip
Transfer-Encoding: chunked
Content-Disposition: attachment; filename=&quot;$ID.zip&quot;
X-Response-Time: 13.556ms
</code></pre>

<p>The zip file contains a comment with the original URL.</p>
<pre><code class="bash">$ unzip -z CXE1c.zip
Archive:  CXE1c.zip
Created by o2r [https://…/api/v1/compendium/CXE1c.zip]
</code></pre>

<h3 id="url-parameters-for-compendium-download">URL parameters for compendium download</h3>
<ul>
<li><code>:id</code> - the compendiums id</li>
<li><code>?gzip</code> - <em>only for .tar endpoint</em> - compress tarball with gzip</li>
<li><code>?image=true</code> or <code>?image=false</code> - include tarball of Docker image in the archive, default is <code>true</code></li>
</ul>
<h3 id="error-responses-for-compendium-download">Error responses for compendium download</h3>
<pre><code class="bash">404 Not Found

{&quot;error&quot;:&quot;no compendium with this id&quot;}
</code></pre>

<h2 id="list-related-execution-jobs">List related execution jobs</h2>
<p><code>curl https://…/api/v1/compendium/$ID/jobs</code></p>
<p><code>GET /api/v1/compendium/:id/jobs</code></p>
<pre><code class="json">200 OK
{
  &quot;results&quot;:[
    &quot;nkm4L&quot;,
    &quot;asdi5&quot;,
    &quot;nb2sg&quot;,
    …
  ],
  &quot;next&quot;:&quot;/api/v1/compendium/:id/jobs?limit=100&amp;start=3&quot;,
  &quot;previous&quot;:&quot;/api/v1/compendium/:id/job?limit=100&amp;start=1&quot;
}
</code></pre>

<h3 id="url-parameters-for-related-execution-jobs">URL parameters for related execution jobs</h3>
<ul>
<li><code>:id</code> - compendium id that the results should be related to</li>
</ul>
<h3 id="error-response-for-related-execution-jobs">Error response for related execution jobs</h3>
<pre><code class="json">404 Not Found

{&quot;error&quot;:&quot;no job found&quot;}
</code></pre>

<h2 id="metadata">Metadata</h2>
<h3 id="basics">Basics</h3>
<p>Metadata in a compendium is stored in a directory <code>.erc</code>. This directory contains the normative metadata documents using a file naming scheme <code>&lt;metadata_model&gt;.&lt;format&gt;</code>, sometimes preprended with <code>metadata_</code> for clarity, e.g. <code>metadata_raw.json</code>, <code>metadata_o2r.json</code>, <code>zenodo.json</code>, or <code>datacite.xml</code>.</p>
<p>A copy of the files in this directory is kept in database for easier access, so every compendium returned by the API can contain different sub-properties in the metadata property. <em>This API always returns the database copy of the metadata elements.</em> You can download the respective files to access the normative metadata documents.</p>
<p>Both the files and the sub-properties are only available <em>on-demand</em>, so for example after a shipment to Zenodo is initiated. After creation the metadata is persisted to file and database.</p>
<p>The sub-properties and their features are</p>
<ul>
<li><code>raw</code> contains raw metadata extracted automatically</li>
<li><code>o2r</code> holds the <strong>main information for display</strong> and is modelled according the the o2r metadata model. This metadata is first an automatic transformation of raw metadata and should then be checked by the uploading user during the upload process.</li>
<li><code>datacite</code> (TBD) holds DataCite XML</li>
<li><code>zenodo</code> holds <a href="https://zenodo.org/">Zenodo</a> metadata for shipments made to Zenodo</li>
</ul>
<p><strong>Note:</strong> The information in each sub-property are subject to independent workflows and may differ from one another.</p>
<p>Future sub-properties might expose <code>enriched</code> or <code>harvested</code> metadata.</p>
<h3 id="url-parameters-for-metadata">URL parameters for metadata</h3>
<ul>
<li><code>:id</code> - compendium id</li>
</ul>
<h3 id="get-metadata-example-request-and-response">GET metadata - example request and response</h3>
<p><code>curl https://…/api/v1/$ID</code></p>
<p><code>GET /api/v1/compendium/:id</code></p>
<pre><code class="json">200 OK

{
  &quot;id&quot;:&quot;compendium_id&quot;,
  &quot;metadata&quot;: {
    &quot;raw&quot;: {
      &quot;title&quot;: &quot;Programming with Data. Springer, New York, 1998. ISBN 978-0-387-98503-9.&quot;,
      &quot;author&quot;: &quot;John M. Chambers.   &quot;
    },
    &quot;o2r&quot;: {
      &quot;title&quot;: &quot;Programming with Data&quot;,
      &quot;creator&quot;: &quot;John M. Chambers&quot;,
      &quot;year&quot;: 1998
    }, {
      …
    }
  },
  &quot;created&quot;: …,
  &quot;files&quot;: …
}
</code></pre>

<h3 id="update-metadata-work-in-progress">Update metadata - WORK IN PROGRESS</h3>
<p>The following endpoint can be used to update the <code>o2r</code> metadata elements.
Only authors of a compendium can update the metadata.
All other metadata sub-properties are only updated by the platform itself.</p>
<h4 id="metadata-update-request">Metadata update request</h4>
<pre><code class="bash">curl -H 'Content-Type: application/json' \
  -X PUT \
  --cookie &quot;connect.sid=&lt;code string here&gt;&quot; \
  -d '{ &quot;o2r&quot;: { &quot;title&quot;: &quot;Blue Book&quot; } }' \
  /api/v1/compendium/:id/metadata
</code></pre>

<p>The request will <em>overwrite</em> the existing metadata properties, so the full o2r metadata must be put with a JSON object called <code>o2r</code> at the root, even if only specific fields are changed.</p>
<h4 id="metadata-update-response">Metadata update response</h4>
<p>The response contains an excerpt of a compendium with only the o2r metadata property.</p>
<pre><code class="json">200 OK

{
  &quot;id&quot;:&quot;compendium_id&quot;,
  &quot;metadata&quot;: {
    &quot;o2r&quot;: {
      &quot;title&quot;: &quot;Blue Book&quot;
    }
  }
}
</code></pre>

<p>This response is also available at <code>GET /api/v1/compendium/:id/metadata</code>.</p>
<h3 id="metadata-update-error-responses">Metadata update error responses</h3>
<pre><code class="json">401 Unauthorized

{&quot;error&quot;:&quot;not authorized&quot;}
</code></pre>

<pre><code class="json">400 Bad Request

{&quot;error&quot;:&quot;invalid JSON&quot;}
</code></pre>

<pre><code class="json">422 Unprocessable Entity

{&quot;error&quot;:&quot;JSON with root element 'o2r' required&quot;}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../files/" class="btn btn-neutral float-right" title="Files in a compendium">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../public-share/" class="btn btn-neutral" title="Public share submission"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../public-share/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../files/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
