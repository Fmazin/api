<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>User - o2r web API</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../o2r.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "User";
    var mkdocs_page_input_path = "user.md";
    var mkdocs_page_url = "/user/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> o2r web API</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Compendium</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Create new compendium</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../compendium/upload/">API upload</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../compendium/public_share/">Public share submission</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../compendium/candidate/">Candidates</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../compendium/view/">View</a>
                </li>
                <li class="">
                    
    <a class="" href="../compendium/delete/">Delete</a>
                </li>
                <li class="">
                    
    <a class="" href="../compendium/download/">Download</a>
                </li>
                <li class="">
                    
    <a class="" href="../compendium/metadata/">Metadata</a>
                </li>
                <li class="">
                    
    <a class="" href="../compendium/files/">Files in a compendium</a>
                </li>
                <li class="">
                    
    <a class="" href="../compendium/substitute/">Substitution</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../job/">Job</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../search/">Search</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../shipment/">Shipment</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">User</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#user">User</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#list-users">List users</a></li>
        
            <li><a class="toctree-l3" href="#view-single-user">View single user</a></li>
        
            <li><a class="toctree-l3" href="#authentication">Authentication</a></li>
        
            <li><a class="toctree-l3" href="#user-levels">User levels</a></li>
        
            <li><a class="toctree-l3" href="#edit-user">Edit user</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">o2r web API</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>User</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="user">User</h1>
<h2 id="list-users">List users</h2>
<p>Return a list of user ids. <a href="../compendium/view/">Pagination (including defaults) as described for compendia</a> is available for users.</p>
<p><code>curl https://…/api/v1/user</code></p>
<p><code>GET /api/v1/user</code></p>
<pre><code class="json">200 OK

{
    &quot;results&quot;: [
        &quot;0000-0002-1825-0097&quot;,
        &quot;0000-0001-6021-1617&quot;
    ]
}
</code></pre>

<h2 id="view-single-user">View single user</h2>
<p>Show the details of a user.</p>
<p><code>curl https://…/api/v1/user/$ID</code></p>
<p><code>GET /api/v1/user/:id</code></p>
<pre><code class="json">200 OK

{
    &quot;id&quot;: &quot;0000-0001-6021-1617&quot;,
    &quot;name&quot;: &quot;o2r&quot;
}
</code></pre>

<p>The content of the response depends on the state and level of the user that requests the resource. The above response only contains the id and the publicly visible name. The following response contains more details and requires a certain user level of the authenticated user making the request:</p>
<p><code>curl --cookie "connect.sid=&lt;session cookie here&gt;" https://…/api/v1/user/0000-0001-6021-1617</code></p>
<pre><code class="json">200 OK

{
    &quot;id&quot;: &quot;0000-0001-6021-1617&quot;,
    &quot;name&quot;: &quot;o2r&quot;,
    &quot;level&quot;: 0,
    &quot;lastseen&quot;: &quot;2016-08-15T12:32:23.972Z&quot;
}
</code></pre>

<h3 id="url-parameters-for-single-user-view">URL parameters for single user view</h3>
<ul>
<li><code>:id</code> - the user id</li>
</ul>
<h3 id="error-responses-for-single-user-view">Error responses for single user view</h3>
<pre><code class="json">404 Not Found

{&quot;error&quot;:&quot;no user with this id&quot;}
</code></pre>

<h2 id="authentication">Authentication</h2>
<p>User authentication is done via authenticated sessions, which are referenced with a cookie called <code>connect.sid</code>. For every endpoint that needs user authentication, a cookie with an authenticated session is required.</p>
<h3 id="access-authentication-information-for-direct-api-access">Access authentication information for direct API access</h3>
<p>To run commands which require authentication from the command line, a user must login on the website first. Then open you browser cookies and find a cookie issued by <code>o2r.uni-muenster.de</code> with the name <code>connect.sid</code>. Use the the contents of the cookie for your requests, for example as shown below when using curl.</p>
<pre><code class="bash">curl [...] --cookie &quot;connect.sid=&lt;code string here&gt;&quot; \
     https://…/api/v1/endpoint
</code></pre>

<h3 id="authentication-within-microservices">Authentication within microservices</h3>
<p><strong>Attention:</strong> The authentication process <em>requires</em> a secured connection, i.e. <code>HTTPS</code>.</p>
<h4 id="authentication-provider">Authentication provider</h4>
<p>Session authentication is done using the OAuth 2.0 protocol. Currently <a href="https://www.orcid.org">ORCID</a> is the only available authentication provider, therefore users need to be registered with ORCID. Because of its nature, the authentication workflow is not a RESTful service. Users will need to navigate to the login endpoint with their webbrowser and grant access to the o2r platform for their ORCID account. They will then be sent back to our authentication service, which verifies the authentification request and enriches the user session with the verified ORCID for this user.</p>
<h4 id="start-oauth-login">Start OAuth login</h4>
<p>Navigate the webbrowser (e.g. via a HTML <code>&lt;a&gt;</code> link) to <code>/api/v1/auth/login</code>, which will then redirect the user and request access to your ORCID profile. After granting access, ORCID will redirect the user back to the <code>/api/v1/auth/login</code> endpoint with a unique <code>code</code> param that is used to verify the request.</p>
<p>If the verification was successful, the endpoint returns a session cookie named <code>connect.sid</code>, which is tied to a authenticated session. The server answers with a <code>301 redirect</code>, which redirects the user back to <code>/</code>, where the o2r platform webinterface resides.</p>
<p>If the login is unsuccessful, the user is not redirected back to the site and no further redirects are configured.</p>
<h4 id="request-authentication-status">Request authentication status</h4>
<p>As the cookie is present in both authenticated and unauthenticated sessions, clients (e.g. webbrowsers) will need to know if their session is authenticated, and if so, as which ORCID user. For this, send a <code>GET</code> request to the <code>/api/v1/auth/whoami</code> endpoint, including your session cookie.</p>
<p><code>curl https://…/api/v1/auth/whoami --cookie "connect.sid=…</code></p>
<p><code>GET /api/v1/auth/whoami</code></p>
<pre><code class="json">200 OK

{
  &quot;orcid&quot;: &quot;0000-0001-6021-1617&quot;,
  &quot;name&quot;: &quot;o2r&quot;
}
</code></pre>

<h4 id="error-response-for-requests-requiring-authentication">Error response for requests requiring authentication</h4>
<p>When no session cookie was included, or the included session cookie does not belong to a authenticated session, the service will respond with a <code>401 Unauthorized</code> message.</p>
<pre><code class="json">401 Unauthorized

{
  &quot;error&quot;: &quot;not authenticated&quot;
}
</code></pre>

<h2 id="user-levels">User levels</h2>
<p>Users are authenticated via OAuth and the actions on the website are limited by the <code>level</code> assocciated with an account.
On registration, each account is assigned a level <code>0</code>.
Only admin users and the user herself can read the level of a user.</p>
<p>The following is a list of actions and the corresponding required <em>minimum</em> user level.</p>
<ul>
<li><code>0</code> <em>Users</em> (everybody)<ul>
<li>Create new jobs</li>
<li>View compendia, jobs, user details</li>
</ul>
</li>
<li><code>100</code> <em>Known users</em><ul>
<li>Create new compendium</li>
<li>Create shipments</li>
<li>Create substitutions</li>
<li>Delete own candidates</li>
</ul>
</li>
<li><code>500</code> <em>Editors</em><ul>
<li>Edit user levels</li>
<li>Edit metadata of other user's compendia</li>
<li>View other user's candidates</li>
</ul>
</li>
<li><code>1000</code> <em>Admins</em><ul>
<li>Delete candidates</li>
<li>View status pages of microservices</li>
</ul>
</li>
</ul>
<h2 id="edit-user">Edit user</h2>
<p>You can update information of an existing user using the <code>HTTP</code> operation <code>PATCH</code>.</p>
<h3 id="change-user-level-request">Change user level request</h3>
<p>The user level can be changed with an <code>HTTP</code> <code>PATCH</code> request.
The new level is passed to the API via a query parameter, i.e. <code>..?level=&lt;new level value&gt;</code>.
The value must be an <code>int</code> (integer).
The response is the full user document with the updated value.</p>
<div class="admonition note">
<p class="admonition-title">Required user level</p>
<p>The user sending the request to change the level must have the required <a href="./#user-levels">user level</a>.</p>
</div>
<pre><code class="bash">curl --request PATCH --cookie &quot;connect.sid=&lt;session cookie here&gt;&quot; \
  https://…/api/v1/user/0000-0001-6021-1617?level=42`
</code></pre>

<pre><code class="json">200 OK

{
    &quot;id&quot;: &quot;0000-0001-6021-1617&quot;,
    &quot;name&quot;: &quot;o2r&quot;,
    &quot;level&quot;: 42,
    &quot;lastseen&quot;: &quot;2016-08-15T12:32:23.972Z&quot;
}
</code></pre>

<h3 id="error-responses-for-user-level-change">Error responses for user level change</h3>
<pre><code class="json">401 Unauthorized

{
  &quot;error&quot;: &quot;user is not authenticated&quot;
}
</code></pre>

<pre><code class="json">401 Unauthorized

{
  &quot;error&quot;: &quot;user level does not allow edit&quot;
}
</code></pre>

<pre><code class="json">400 Bad Request

{
  &quot;error&quot;: &quot;parameter 'level' could not be parsed as an integer&quot;
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../shipment/" class="btn btn-neutral" title="Shipment"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../shipment/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
